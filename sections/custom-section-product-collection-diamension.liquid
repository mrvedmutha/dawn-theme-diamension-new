{% comment %}
  Section: Product Collection Diamension
  Purpose: Custom collection page with progressive loading and promotional image cards
  Author: Wings Design Team
  Version: 1.0
{% endcomment %}

{{ 'section-product-collection-diamension.css' | asset_url | stylesheet_tag }}

{% liquid
  assign breadcrumb_menu = section.settings.breadcrumb_menu
  assign products_per_page = section.settings.products_per_page | default: 20
  assign show_filter = section.settings.show_filter_button
  assign show_sort = section.settings.show_sort_button
  assign enable_ajax = section.settings.enable_ajax_loading

  assign hero_image = collection.metafields.custom.collection_hero_image
  assign hero_caption = collection.metafields.custom.collection_caption
  assign first_image_card = collection.metafields.custom.collection_first_image.value
  assign second_image_card = collection.metafields.custom.collection_second_image.value

  assign total_products = collection.products_count
  assign has_enough_for_images = false
  if total_products >= 10
    assign has_enough_for_images = true
  endif

  comment
    Calculate min and max prices from ALL products in collection
  endcomment
  assign min_price = 999999999
  assign max_price = 0

  for product in collection.products
    assign product_price = product.price | divided_by: 100.0
    if product_price < min_price
      assign min_price = product_price
    endif
    if product_price > max_price
      assign max_price = product_price
    endif
  endfor

  comment
    If no products, set defaults
  endcomment
  if min_price == 999999999
    assign min_price = 0
  endif
%}

<div
  class="custom-section-product-collection-diamension"
  data-section-id="{{ section.id }}"
  data-collection-handle="{{ collection.handle }}"
  data-collection-min-price="{{ min_price }}"
  data-collection-max-price="{{ max_price }}"
>
  {% comment %} Header section with breadcrumb, title, and hero {% endcomment %}
  <div class="custom-section-product-collection-diamension__header-section">
    {% comment %} Breadcrumb {% endcomment %}
    <nav class="custom-section-product-collection-diamension__breadcrumb" aria-label="Breadcrumb">
      {% if breadcrumb_menu and linklists[breadcrumb_menu] %}
        {% for link in linklists[breadcrumb_menu].links %}
          <a href="{{ link.url }}" class="custom-section-product-collection-diamension__breadcrumb-link">
            {{ link.title }}
          </a>
          {% unless forloop.last %}
            <span class="custom-section-product-collection-diamension__breadcrumb-separator">
              <svg width="19" height="1" viewBox="0 0 19 1" fill="none" xmlns="http://www.w3.org/2000/svg">
                <line x1="0" y1="0.5" x2="19" y2="0.5" stroke="#183754"/>
              </svg>
            </span>
          {% endunless %}
        {% endfor %}
        <span class="custom-section-product-collection-diamension__breadcrumb-separator">
          <svg width="19" height="1" viewBox="0 0 19 1" fill="none" xmlns="http://www.w3.org/2000/svg">
            <line x1="0" y1="0.5" x2="19" y2="0.5" stroke="#183754"/>
          </svg>
        </span>
      {% endif %}
      <span class="custom-section-product-collection-diamension__breadcrumb-current">
        {{ collection.title }}
      </span>
    </nav>

    {% comment %} Title + Filter/Sort {% endcomment %}
    <div class="custom-section-product-collection-diamension__title-row">
      <div class="custom-section-product-collection-diamension__title-wrapper">
        <h1 class="custom-section-product-collection-diamension__title">{{ collection.title | upcase }}</h1>
        {% if hero_caption != blank %}
          <div class="custom-section-product-collection-diamension__description">
            {{ hero_caption }}
          </div>
        {% endif %}
      </div>

      <div class="custom-section-product-collection-diamension__controls">
        {% if show_filter %}
          <button
            class="custom-section-product-collection-diamension__filter-btn"
            type="button"
            aria-label="Filter products"
          >
            <img
              src="{{ 'custom-product-collection/icons/filter-icon.svg' | asset_url }}"
              alt=""
              width="24"
              height="24"
            >
            <span>Filter</span>
          </button>
        {% endif %}

        {% if show_sort %}
          <button
            class="custom-section-product-collection-diamension__sort-btn"
            type="button"
            aria-label="Sort products"
          >
            <img src="{{ 'custom-product-collection/icons/sort-icon.svg' | asset_url }}" alt="" width="24" height="24">
            <span>Sort</span>
          </button>
        {% endif %}

        {% comment %} Sort Panel {% endcomment %}
        <div class="custom-section-product-collection-diamension__sort-panel" data-sort-panel>
          {% comment %} Sort Header {% endcomment %}
          <div class="custom-section-product-collection-diamension__sort-header">
            <button
              class="custom-section-product-collection-diamension__sort-close"
              data-sort-close
              type="button"
              aria-label="Close sort"
            >
              <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M24 8L8 24M8 8L24 24" stroke="#183754" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button>
          </div>

          {% comment %} Sort Options {% endcomment %}
          <div class="custom-section-product-collection-diamension__sort-content">
            <button
              class="custom-section-product-collection-diamension__sort-option"
              data-sort-option="featured"
              type="button"
            >
              Featured
            </button>
            <button
              class="custom-section-product-collection-diamension__sort-option"
              data-sort-option="best-selling"
              type="button"
            >
              Best Selling
            </button>
            <button
              class="custom-section-product-collection-diamension__sort-option"
              data-sort-option="price-low-high"
              type="button"
            >
              Price : Low to High
            </button>
            <button
              class="custom-section-product-collection-diamension__sort-option"
              data-sort-option="price-high-low"
              type="button"
            >
              Price : High to Low
            </button>
          </div>
        </div>

        {% comment %} Filter Panel {% endcomment %}
        <div class="custom-section-product-collection-diamension__filter-panel" data-filter-panel>
          {% comment %} Filter Header {% endcomment %}
          <div class="custom-section-product-collection-diamension__filter-header">
            <h2 class="custom-section-product-collection-diamension__filter-title">Filter</h2>
            <button
              class="custom-section-product-collection-diamension__filter-close"
              data-filter-close
              type="button"
              aria-label="Close filter"
            >
              <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M24 8L8 24M8 8L24 24" stroke="#183754" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button>
          </div>

          {% comment %} Filter Content (Scrollable) {% endcomment %}
          <div class="custom-section-product-collection-diamension__filter-content" data-filter-content>
            {% comment %} Categories Filter (from product.type) - Moved to Top {% endcomment %}
            <div class="custom-section-product-collection-diamension__filter-group">
              <button class="custom-section-product-collection-diamension__filter-group-header" data-accordion-toggle>
                <span>CATEGORIES</span>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M6 9L12 15L18 9" stroke="#3E6282" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </button>
              <div class="custom-section-product-collection-diamension__filter-group-content" data-accordion-content>
                <label class="custom-section-product-collection-diamension__filter-option">
                  <input
                    type="checkbox"
                    name="categories"
                    value="Rings"
                    data-filter-checkbox="categories"
                  >
                  <span class="custom-section-product-collection-diamension__filter-checkbox"></span>
                  <span class="custom-section-product-collection-diamension__filter-label">Rings</span>
                </label>
                <label class="custom-section-product-collection-diamension__filter-option">
                  <input
                    type="checkbox"
                    name="categories"
                    value="Earrings"
                    data-filter-checkbox="categories"
                  >
                  <span class="custom-section-product-collection-diamension__filter-checkbox"></span>
                  <span class="custom-section-product-collection-diamension__filter-label">Earrings</span>
                </label>
                <label class="custom-section-product-collection-diamension__filter-option">
                  <input
                    type="checkbox"
                    name="categories"
                    value="Bracelets"
                    data-filter-checkbox="categories"
                  >
                  <span class="custom-section-product-collection-diamension__filter-checkbox"></span>
                  <span class="custom-section-product-collection-diamension__filter-label">Bracelets</span>
                </label>
                <label class="custom-section-product-collection-diamension__filter-option">
                  <input
                    type="checkbox"
                    name="categories"
                    value="Pendants"
                    data-filter-checkbox="categories"
                  >
                  <span class="custom-section-product-collection-diamension__filter-checkbox"></span>
                  <span class="custom-section-product-collection-diamension__filter-label">Pendants</span>
                </label>
              </div>
            </div>

            {% comment %} Price Filter {% endcomment %}
            {% if section.settings.show_price_filter %}
              <div class="custom-section-product-collection-diamension__filter-group">
                <button class="custom-section-product-collection-diamension__filter-group-header" data-accordion-toggle>
                  <span>PRICE</span>
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6 9L12 15L18 9" stroke="#3E6282" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                </button>
                <div class="custom-section-product-collection-diamension__filter-group-content" data-accordion-content>
                  <div class="custom-section-product-collection-diamension__filter-price">
                    <div class="custom-section-product-collection-diamension__filter-price-slider" data-price-slider>
                      <input type="range" data-price-min>
                      <input type="range" data-price-max>
                    </div>
                    <div class="custom-section-product-collection-diamension__filter-price-inputs">
                      <input type="text" readonly data-price-min-display>
                      <input type="text" readonly data-price-max-display>
                    </div>
                  </div>
                </div>
              </div>
            {% endif %}

            {% comment %} Sub-Categories Filter (tags-based, conditional visibility) {% endcomment %}
            <div class="custom-section-product-collection-diamension__filter-group" data-subcategories-group>
              <button class="custom-section-product-collection-diamension__filter-group-header" data-accordion-toggle>
                <span>SUB-CATEGORIES</span>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M6 9L12 15L18 9" stroke="#3E6282" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </button>
              <div class="custom-section-product-collection-diamension__filter-group-content" data-accordion-content>
                {% comment %} Rings Sub-Categories {% endcomment %}
                <label class="custom-section-product-collection-diamension__filter-option" data-parent-category="rings">
                  <input
                    type="checkbox"
                    name="subcategories"
                    value="Solitaire Ring"
                    data-filter-checkbox="subcategories"
                    data-parent="rings"
                  >
                  <span class="custom-section-product-collection-diamension__filter-checkbox"></span>
                  <span class="custom-section-product-collection-diamension__filter-label">Solitaire Ring</span>
                </label>
                <label class="custom-section-product-collection-diamension__filter-option" data-parent-category="rings">
                  <input
                    type="checkbox"
                    name="subcategories"
                    value="Bands"
                    data-filter-checkbox="subcategories"
                    data-parent="rings"
                  >
                  <span class="custom-section-product-collection-diamension__filter-checkbox"></span>
                  <span class="custom-section-product-collection-diamension__filter-label">Bands</span>
                </label>
                <label class="custom-section-product-collection-diamension__filter-option" data-parent-category="rings">
                  <input
                    type="checkbox"
                    name="subcategories"
                    value="Designer Rings"
                    data-filter-checkbox="subcategories"
                    data-parent="rings"
                  >
                  <span class="custom-section-product-collection-diamension__filter-checkbox"></span>
                  <span class="custom-section-product-collection-diamension__filter-label">Designer Rings</span>
                </label>

                {% comment %} Earrings Sub-Categories {% endcomment %}
                <label class="custom-section-product-collection-diamension__filter-option" data-parent-category="earrings">
                  <input
                    type="checkbox"
                    name="subcategories"
                    value="Studs"
                    data-filter-checkbox="subcategories"
                    data-parent="earrings"
                  >
                  <span class="custom-section-product-collection-diamension__filter-checkbox"></span>
                  <span class="custom-section-product-collection-diamension__filter-label">Studs</span>
                </label>
                <label class="custom-section-product-collection-diamension__filter-option" data-parent-category="earrings">
                  <input
                    type="checkbox"
                    name="subcategories"
                    value="Everyday Wear"
                    data-filter-checkbox="subcategories"
                    data-parent="earrings"
                  >
                  <span class="custom-section-product-collection-diamension__filter-checkbox"></span>
                  <span class="custom-section-product-collection-diamension__filter-label">Everyday Wear</span>
                </label>
                <label class="custom-section-product-collection-diamension__filter-option" data-parent-category="earrings">
                  <input
                    type="checkbox"
                    name="subcategories"
                    value="Designer Earrings"
                    data-filter-checkbox="subcategories"
                    data-parent="earrings"
                  >
                  <span class="custom-section-product-collection-diamension__filter-checkbox"></span>
                  <span class="custom-section-product-collection-diamension__filter-label">Designer Earrings</span>
                </label>
                <label class="custom-section-product-collection-diamension__filter-option" data-parent-category="earrings">
                  <input
                    type="checkbox"
                    name="subcategories"
                    value="Hoops/Huggies"
                    data-filter-checkbox="subcategories"
                    data-parent="earrings"
                  >
                  <span class="custom-section-product-collection-diamension__filter-checkbox"></span>
                  <span class="custom-section-product-collection-diamension__filter-label">Hoops/Huggies</span>
                </label>

                {% comment %} Bracelets Sub-Categories {% endcomment %}
                <label class="custom-section-product-collection-diamension__filter-option" data-parent-category="bracelets">
                  <input
                    type="checkbox"
                    name="subcategories"
                    value="Solitaire Tennis Bracelet"
                    data-filter-checkbox="subcategories"
                    data-parent="bracelets"
                  >
                  <span class="custom-section-product-collection-diamension__filter-checkbox"></span>
                  <span class="custom-section-product-collection-diamension__filter-label">Solitaire Tennis Bracelet</span>
                </label>
                <label class="custom-section-product-collection-diamension__filter-option" data-parent-category="bracelets">
                  <input
                    type="checkbox"
                    name="subcategories"
                    value="Designer Tennis Bracelet"
                    data-filter-checkbox="subcategories"
                    data-parent="bracelets"
                  >
                  <span class="custom-section-product-collection-diamension__filter-checkbox"></span>
                  <span class="custom-section-product-collection-diamension__filter-label">Designer Tennis Bracelet</span>
                </label>
                <label class="custom-section-product-collection-diamension__filter-option" data-parent-category="bracelets">
                  <input
                    type="checkbox"
                    name="subcategories"
                    value="Oval Bracelet"
                    data-filter-checkbox="subcategories"
                    data-parent="bracelets"
                  >
                  <span class="custom-section-product-collection-diamension__filter-checkbox"></span>
                  <span class="custom-section-product-collection-diamension__filter-label">Oval Bracelet</span>
                </label>

                {% comment %} Pendants Sub-Categories {% endcomment %}
                <label class="custom-section-product-collection-diamension__filter-option" data-parent-category="pendants">
                  <input
                    type="checkbox"
                    name="subcategories"
                    value="Solitaire Pendants"
                    data-filter-checkbox="subcategories"
                    data-parent="pendants"
                  >
                  <span class="custom-section-product-collection-diamension__filter-checkbox"></span>
                  <span class="custom-section-product-collection-diamension__filter-label">Solitaire Pendants</span>
                </label>
                <label class="custom-section-product-collection-diamension__filter-option" data-parent-category="pendants">
                  <input
                    type="checkbox"
                    name="subcategories"
                    value="Designer Pendants"
                    data-filter-checkbox="subcategories"
                    data-parent="pendants"
                  >
                  <span class="custom-section-product-collection-diamension__filter-checkbox"></span>
                  <span class="custom-section-product-collection-diamension__filter-label">Designer Pendants</span>
                </label>
                <label class="custom-section-product-collection-diamension__filter-option" data-parent-category="pendants">
                  <input
                    type="checkbox"
                    name="subcategories"
                    value="Pendant Sets"
                    data-filter-checkbox="subcategories"
                    data-parent="pendants"
                  >
                  <span class="custom-section-product-collection-diamension__filter-checkbox"></span>
                  <span class="custom-section-product-collection-diamension__filter-label">Pendant Sets</span>
                </label>
              </div>
            </div>

            {% comment %} From The Studio Filter (tags-based, with collection-specific disabling) {% endcomment %}
            {% assign is_in_corporate = false %}
            {% assign is_in_celebrations = false %}
            {% assign is_in_foundations = false %}

            {% if collection.handle == 'corporate-comeback' %}
              {% assign is_in_corporate = true %}
            {% elsif collection.handle == 'celebrations' or collection.handle == 'the-celebrations' %}
              {% assign is_in_celebrations = true %}
            {% elsif collection.handle == 'the-foundations' %}
              {% assign is_in_foundations = true %}
            {% endif %}

            <div class="custom-section-product-collection-diamension__filter-group">
              <button class="custom-section-product-collection-diamension__filter-group-header" data-accordion-toggle>
                <span>FROM THE STUDIO</span>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M6 9L12 15L18 9" stroke="#3E6282" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </button>
              <div class="custom-section-product-collection-diamension__filter-group-content" data-accordion-content>
                <label class="custom-section-product-collection-diamension__filter-option">
                  <input
                    type="checkbox"
                    name="fromthestudio"
                    value="Corporate Comeback"
                    data-filter-checkbox="fromthestudio"
                    {% if is_in_celebrations or is_in_foundations %}disabled{% endif %}
                  >
                  <span class="custom-section-product-collection-diamension__filter-checkbox"></span>
                  <span class="custom-section-product-collection-diamension__filter-label">Corporate Comeback</span>
                </label>
                <label class="custom-section-product-collection-diamension__filter-option">
                  <input
                    type="checkbox"
                    name="fromthestudio"
                    value="The Celebrations"
                    data-filter-checkbox="fromthestudio"
                    {% if is_in_corporate or is_in_foundations %}disabled{% endif %}
                  >
                  <span class="custom-section-product-collection-diamension__filter-checkbox"></span>
                  <span class="custom-section-product-collection-diamension__filter-label">The Celebrations</span>
                </label>
                <label class="custom-section-product-collection-diamension__filter-option">
                  <input
                    type="checkbox"
                    name="fromthestudio"
                    value="The Foundations"
                    data-filter-checkbox="fromthestudio"
                    {% if is_in_corporate or is_in_celebrations %}disabled{% endif %}
                  >
                  <span class="custom-section-product-collection-diamension__filter-checkbox"></span>
                  <span class="custom-section-product-collection-diamension__filter-label">The Foundations</span>
                </label>
              </div>
            </div>
          </div>

          {% comment %} Filter Footer {% endcomment %}
          <div class="custom-section-product-collection-diamension__filter-footer">
            <button
              class="custom-section-product-collection-diamension__filter-clear"
              data-filter-clear
              type="button"
            >
              CLEAR ALL
            </button>
            <button
              class="custom-section-product-collection-diamension__filter-apply"
              data-filter-apply
              type="button"
            >
              APPLY
            </button>
          </div>
        </div>
      </div>
    </div>

    {% comment %} Hero image (full-width) {% endcomment %}
    {% if hero_image != blank %}
      <div class="custom-section-product-collection-diamension__hero">
        <img
          src="{{ hero_image | image_url: width: 1440 }}"
          srcset="
            {{ hero_image | image_url: width: 768 }} 768w,
            {{ hero_image | image_url: width: 1024 }} 1024w,
            {{ hero_image | image_url: width: 1440 }} 1440w,
            {{ hero_image | image_url: width: 1920 }} 1920w
          "
          sizes="100vw"
          alt="{{ collection.title | escape }}"
          loading="eager"
          class="custom-section-product-collection-diamension__hero-image"
        >
      </div>
    {% endif %}
  </div>

  {% comment %} Products section {% endcomment %}
  <div class="custom-section-product-collection-diamension__products-section">
    {% comment %} No products message {% endcomment %}
    <div class="custom-section-product-collection-diamension__no-products" data-no-products style="display: none;">
      <p>No products match your selected filters.</p>
    </div>

    {% paginate collection.products by products_per_page %}
      <div class="custom-section-product-collection-diamension__grid" data-product-grid>
        {% for product in collection.products %}
          {% assign index = forloop.index %}

          {% comment %} Render product card {% endcomment %}
          {% render 'product-card-collection-diamension', product: product %}

          {% comment %} First image card after product 10 {% endcomment %}
          {% if index == 10 and has_enough_for_images and first_image_card %}
            {% render 'image-card-collection-diamension', image_card: first_image_card %}
          {% endif %}

          {% comment %} Second image card after product 18 {% endcomment %}
          {% if index == 18 and has_enough_for_images and second_image_card %}
            {% render 'image-card-collection-diamension', image_card: second_image_card %}
          {% endif %}
        {% endfor %}
      </div>

      {% comment %} Load more section {% endcomment %}
      {% if paginate.pages > 1 %}
        <div class="custom-section-product-collection-diamension__load-more">
          <div class="custom-section-product-collection-diamension__progress">
            <p
              class="custom-section-product-collection-diamension__progress-text"
              data-progress-text
              data-current-offset="{{ paginate.current_offset }}"
              data-page-size="{{ paginate.page_size }}"
              data-total-items="{{ paginate.items }}"
            >
              Showing {{ paginate.current_offset | plus: paginate.page_size | at_most: paginate.items }} of
              {{ paginate.items }} products
            </p>
            <div class="custom-section-product-collection-diamension__progress-line">
              <svg width="110" height="1" viewBox="0 0 110 1" fill="none" xmlns="http://www.w3.org/2000/svg">
                <line x1="0" y1="0.5" x2="110" y2="0.5" stroke="#183754"/>
              </svg>
            </div>
          </div>

          {% unless paginate.next == null %}
            <button
              class="custom-section-product-collection-diamension__load-more-btn"
              data-load-more
              data-next-url="{{ paginate.next.url }}"
            >
              LOAD MORE
            </button>
          {% endunless %}
        </div>
      {% endif %}
    {% endpaginate %}
  </div>
</div>

<script src="{{ 'section-product-collection-diamension.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Product Collection Custom",
  "class": "section-collection-diamension",
  "settings": [
    {
      "type": "link_list",
      "id": "breadcrumb_menu",
      "label": "Breadcrumb Menu",
      "info": "Select menu for breadcrumb navigation"
    },
    {
      "type": "range",
      "id": "products_per_page",
      "label": "Products Per Page",
      "min": 12,
      "max": 40,
      "step": 4,
      "default": 20
    },
    {
      "type": "checkbox",
      "id": "show_filter_button",
      "label": "Show Filter Button",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_sort_button",
      "label": "Show Sort Button",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_ajax_loading",
      "label": "Enable AJAX Loading",
      "default": true,
      "info": "Load more products without page refresh"
    },
    {
      "type": "header",
      "content": "Filter Settings"
    },
    {
      "type": "checkbox",
      "id": "show_price_filter",
      "label": "Show Price Filter",
      "default": true
    },
    {
      "type": "paragraph",
      "content": "Categories, Sub-Categories, and From The Studio filters are hardcoded and cannot be modified from the theme editor."
    }
  ],
  "presets": [
    {
      "name": "Product Collection Diamension"
    }
  ]
}
{% endschema %}
