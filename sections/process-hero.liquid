{{ 'process-hero.css' | asset_url | stylesheet_tag }}

{%- comment -%} Process Hero Section - Scroll-driven storytelling experience {%- endcomment -%}
<div class="process-hero" data-section-id="{{ section.id }}" data-process-hero>
  {%- comment -%} Pinned Container - ScrollTrigger pins this {%- endcomment -%}
  <div class="process-hero__pinned" data-pinned-container style="--bg-color: {{ section.settings.background_color }}; --text-color: {{ section.settings.text_color }};">

    {%- comment -%} Layer 1: Background Color {%- endcomment -%}
    <div class="process-hero__bg">&nbsp;</div>

    {%- comment -%} Layer 2: Diamension Logo Outline (rotated) {%- endcomment -%}
    <div class="process-hero__logo" aria-hidden="true">
      <svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 46 74">
        <path class="cls-1" d="M17.59,73.42c-.95,0-2.1-.53-2.36-1.68-.2-.88-.14-2.2-.09-3.47v-.09c.03-.62.05-1.21.04-1.66-.02-.68-.03-1.41-.05-2.21-.17-8.04-.46-21.48-5.82-26.16-1.39-1.21-3.22-1.63-4.81-1.1v20.42H-.05V5.46h4.55v20.44c1.01.35,2.14.33,3.17-.05,2.17-.81,3.95-3.32,5.28-7.47,1.29-4.03,1.75-8.37,1.88-10.05.06-.71.05-1.58.04-2.64v-.06c-.01-1.38-.02-2.8.17-3.78.23-1.13,1.17-1.89,2.34-1.91.01,0,.03,0,.04,0,1.1,0,2,.69,2.24,1.72.17.73.12,1.71.08,2.67v.03c-.03.59-.05,1.11-.03,1.52.36,7.23,1.71,12.26,4.27,15.82,2.9,4.05,7.54,6.4,14.2,7.16.8.09,1.68.11,2.53.12h.12c1.11.02,2.36.04,3.47.24.6.11,1.11.48,1.42,1.05v.02c.37.67.41,1.52.11,2.22-.66,1.56-3.11,1.49-4.89,1.43-.46-.01-.88-.03-1.15,0-5.5.39-12.81,2.11-16.43,8.09-3.88,6.39-3.74,16.81-3.64,24.41v.54c.01.23.04.55.09.98.19,1.94.52,5.17-1.94,5.43-.09,0-.18.01-.28.01ZM5.91,36.72c1.22,0,2.46.47,3.47,1.35,5.39,4.71,5.68,18.18,5.85,26.23.02.79.03,1.53.05,2.21.01.46-.01,1.04-.04,1.67v.09c-.06,1.27-.11,2.58.08,3.45.25,1.1,1.35,1.61,2.26,1.61.1,0,.18,0,.27-.01,2.36-.25,2.04-3.42,1.85-5.32-.04-.43-.08-.76-.08-.99v-.54c-.11-7.62-.25-18.05,3.65-24.47,3.65-6.01,10.99-7.74,16.51-8.14.28-.02.7,0,1.15,0,1.77.05,4.18.13,4.81-1.37.29-.68.25-1.5-.1-2.14v-.02c-.3-.54-.78-.89-1.35-.99-1.11-.2-2.35-.22-3.46-.23h-.12c-.86-.02-1.74-.04-2.54-.13-6.68-.77-11.35-3.13-14.27-7.2-2.56-3.58-3.92-8.63-4.28-15.88-.02-.41,0-.94.03-1.53v-.03c.04-.95.09-1.93-.07-2.64-.22-.99-1.08-1.64-2.14-1.64h-.04c-1.12.01-2.02.75-2.24,1.83-.19.96-.18,2.38-.17,3.76v.06c.01,1.07.02,1.94-.04,2.65-.14,1.68-.59,6.03-1.89,10.07-1.35,4.18-3.14,6.72-5.34,7.53-1.07.4-2.23.41-3.28.04h-.03V5.56H.05v51.81h4.36v-20.4h.03c.47-.17.97-.25,1.47-.25ZM17.44,43.77h-.07v-.03c-.12-.31-.22-.61-.31-.92l-.03-.11c-.73-2.26-1.36-4.22-3.13-6.48-1.62-2.07-3.66-3.41-5.91-3.89-1.14-.24-2.32-.26-3.51-.04h-.06s0-1.69,0-1.69h.06c2.75.51,5.51-.28,7.78-2.21,2.89-2.46,3.84-5.25,4.84-8.2.1-.29.19-.58.3-.87l.05-.13.05.13c1.9,5.2,5.81,9.27,11.31,11.77.22.1.46.19.69.27l.13.05-.13.05c-5.57,2-10.06,6.58-12.02,12.26v.03ZM6.13,32.06c.63,0,1.25.06,1.86.19,2.27.48,4.33,1.84,5.97,3.92,1.78,2.27,2.42,4.24,3.15,6.51l.03.11c.08.26.17.52.26.78,1.98-5.6,6.41-10.12,11.91-12.14-.19-.07-.38-.14-.57-.22-5.48-2.49-9.39-6.54-11.32-11.7-.09.25-.17.49-.25.73-1,2.97-1.95,5.77-4.87,8.25-2.28,1.93-5.04,2.73-7.8,2.25v1.46c.55-.1,1.09-.14,1.63-.14Z"/>
        <path class="cls-1" d="M39.97,26.34h-4.82l-.08-.62c-.05-.39-.1-.72-.18-1.06-1.38-6.05-5.42-10.75-11.08-12.9-.2-.08-1.35-.37-1.72-.47l-.53-.14v-4.83l.85.17c9.02,1.83,16.2,9.66,17.45,19.03l.11.8ZM35.24,26.24h4.62l-.09-.69c-1.25-9.34-8.39-17.13-17.37-18.95l-.73-.15v4.63l.45.12c.65.17,1.54.4,1.73.47,5.69,2.16,9.76,6.88,11.14,12.97.08.34.13.67.18,1.06l.07.53Z"/>
        <path class="cls-1" d="M22.05,56.6v-4.8h.03s.46-.16.46-.16c6.39-2.03,10.9-6.92,12.37-13.44.03-.14.07-.46.1-.76l.07-.62.08-.62h4.82l-.09.79c-1.05,9.31-8.03,17.3-16.98,19.41l-.87.21ZM22.15,51.87v4.6l.75-.18c8.91-2.1,15.86-10.05,16.9-19.32l.08-.68h-4.62l-.14,1.15c-.04.32-.07.63-.1.77-1.48,6.55-6.01,11.48-12.44,13.52l-.43.13Z"/>
      </svg>
    </div>

    {%- comment -%} Layer 3 & 4: Canvas layers (100% width, 1920x1080) {%- endcomment -%}
    <canvas
      class="process-hero__canvas process-hero__canvas--bg"
      data-canvas-bg
      width="1920"
      height="1080"
      aria-label="Process 3D background animation"
    ></canvas>
    <canvas
      class="process-hero__canvas process-hero__canvas--fg"
      data-canvas-fg
      width="1920"
      height="1080"
      aria-label="Process 3D foreground animation"
    ></canvas>

    {%- comment -%} Layer 5: Content Overlay {%- endcomment -%}
    <div class="process-hero__content">

      {%- comment -%} Intro Text (masked reveals) {%- endcomment -%}
      <div class="process-hero__intro" data-intro>
        {%- comment -%} Left Column: Small text + FROM SEED {%- endcomment -%}
        <div class="process-hero__intro-left-col">
          <div class="process-hero__mask">
            <span class="process-hero__intro-small">{{ section.settings.intro_small_text }}</span>
          </div>
          <div class="process-hero__mask">
            <span class="process-hero__intro-large">{{ section.settings.intro_left_text }}</span>
          </div>
        </div>

        {%- comment -%} Right Column: TO SPARKLE {%- endcomment -%}
        <div class="process-hero__intro-right-col">
          <div class="process-hero__mask">
            <span class="process-hero__intro-large">{{ section.settings.intro_right_text }}</span>
          </div>
        </div>
      </div>

      {%- comment -%} Phase Text Containers (3 phases, absolutely stacked) {%- endcomment -%}
      {%- assign phases = section.blocks | where: 'type', 'phase' | slice: 0, 3 -%}
      {%- for phase in phases -%}
        {%- assign phase_num = forloop.index -%}
        {%- assign step_num = phase.settings.step_number_override | default: phase_num -%}
        <div class="process-hero__phase" data-phase="{{ phase_num }}">
          {%- comment -%} Top-Right: Counter {%- endcomment -%}
          <div class="process-hero__phase-counter-container">
            <div class="process-hero__mask">
              <span class="process-hero__phase-counter">({{ step_num | prepend: '0' | slice: -2, 2 }}/03)</span>
            </div>
          </div>

          {%- comment -%} Left Column: Title {%- endcomment -%}
          <div class="process-hero__phase-left">
            <div class="process-hero__mask">
              <span class="process-hero__phase-title">{{ phase.settings.title }}</span>
            </div>
          </div>

          {%- comment -%} Right Column: Description {%- endcomment -%}
          <div class="process-hero__phase-right">
            <div class="process-hero__mask">
              <span class="process-hero__phase-description">{{ phase.settings.description }}</span>
            </div>
          </div>
        </div>
      {%- endfor -%}

      {%- comment -%} Progress Line + Diamond Dots + (KEEP SCROLLING) {%- endcomment -%}
      <div class="process-hero__progress-container" data-progress>
        {%- comment -%} Line Column (90%) {%- endcomment -%}
        <div class="process-hero__progress-line-col">
          <div class="process-hero__progress-line">&nbsp;</div>
          {%- for i in (1..3) -%}
            <div class="process-hero__progress-dot" data-dot="{{ i }}">
              <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M11.8591 6.0095C7.97808 7.06216 7.06216 7.9781 6.0095 11.8591C5.9935 11.9181 5.90982 11.9181 5.89382 11.8591C4.84116 7.97808 3.92522 7.06216 0.0442346 6.0095C-0.0147449 5.9935 -0.0147449 5.90982 0.0442346 5.89382C3.92524 4.84116 4.84116 3.92522 5.89382 0.0442346C5.90982 -0.0147449 5.9935 -0.0147449 6.0095 0.0442346C7.06216 3.92524 7.9781 4.84116 11.8591 5.89382C11.9181 5.90982 11.9181 5.99352 11.8591 6.0095Z" fill="currentColor"/>
              </svg>
            </div>
          {%- endfor -%}
        </div>

        {%- comment -%} Scroll Hint Column (10%) {%- endcomment -%}
        <div class="process-hero__progress-scroll-col">
          <div class="process-hero__mask">
            <span class="process-hero__intro-scroll" data-scroll-hint>{{ section.settings.intro_scroll_text }}</span>
          </div>
        </div>
      </div>

      {%- comment -%} Image Cards Viewport {%- endcomment -%}
      <div class="process-hero__cards-viewport">
        {%- for i in (1..3) -%}
          <div class="process-hero__cards-track" data-track="{{ i }}">
            {%- for block in section.blocks -%}
              {%- if block.type == 'card' and block.settings.phase_number == i -%}
                <div class="process-hero__card">
                  {%- if block.settings.image != blank -%}
                    <div class="process-hero__card-media">
                      <img
                        src="{{ block.settings.image | image_url: width: 800 }}"
                        alt="{{ block.settings.title | escape }}"
                        loading="lazy"
                        width="400"
                        height="225"
                      >
                      {%- if block.settings.title != blank -%}
                        <p class="process-hero__card-title">{{ block.settings.title }}</p>
                      {%- endif -%}
                    </div>
                  {%- elsif block.settings.video_url != blank -%}
                    <div class="process-hero__card-media">
                      <video
                        src="{{ block.settings.video_url }}"
                        muted
                        loop
                        playsinline
                        width="400"
                        height="225"
                      ></video>
                      {%- if block.settings.title != blank -%}
                        <p class="process-hero__card-title">{{ block.settings.title }}</p>
                      {%- endif -%}
                    </div>
                  {%- endif -%}
                </div>
              {%- endif -%}
            {%- endfor -%}
          </div>
        {%- endfor -%}
      </div>

    </div>

    {%- comment -%} Transition Overlay (enter animation) {%- endcomment -%}
    <div class="process-hero__transition-overlay" data-transition-overlay>&nbsp;</div>
  </div>

  {%- comment -%} Spacer for scroll distance {%- endcomment -%}
  <div class="process-hero__spacer" data-spacer style="height: {{ section.settings.scroll_distance }}vh;">&nbsp;</div>

  {%- comment -%} Frame URLs for JavaScript {%- endcomment -%}
  <script>
    window.processHeroData = window.processHeroData || {};
    {%- assign max_frame = section.settings.frame_count | minus: 1 -%}
    window.processHeroData['{{ section.id }}'] = {
      backgroundUrls: [
        {%- for i in (0..max_frame) -%}
          {%- assign frame_num = i | plus: 1 | prepend: '000' | slice: -4, 4 -%}
          "{{ 'custom-section-brillance-3d/background-sequence/2FEB26-BGCubesWebP-f' | append: frame_num | append: 'Output.webp' | asset_url }}"{% unless forloop.last %},{% endunless %}
        {%- endfor -%}
      ],
      foregroundUrls: [
        {%- for i in (0..max_frame) -%}
          {%- assign frame_num = i | plus: 1 | prepend: '000' | slice: -4, 4 -%}
          "{{ 'custom-section-brillance-3d/front-sequence/2FEB26-TweezersCubesWebP-f' | append: frame_num | append: 'Output.webp' | asset_url }}"{% unless forloop.last %},{% endunless %}
        {%- endfor -%}
      ]
    };
  </script>
</div>

<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js" defer></script>
<script src="{{ 'process-hero.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Process Hero",
  "class": "section-process-hero",
  "settings": [
    {
      "type": "header",
      "content": "Intro Text"
    },
    {
      "type": "text",
      "id": "intro_small_text",
      "label": "Small Text",
      "default": "The Making of a CVD Diamond"
    },
    {
      "type": "text",
      "id": "intro_left_text",
      "label": "Left Text",
      "default": "FROM SEED"
    },
    {
      "type": "text",
      "id": "intro_right_text",
      "label": "Right Text",
      "default": "TO SPARKLE"
    },
    {
      "type": "text",
      "id": "intro_scroll_text",
      "label": "Scroll Hint",
      "default": "(KEEP SCROLLING)"
    },
    {
      "type": "header",
      "content": "Animation Settings"
    },
    {
      "type": "range",
      "id": "frame_count",
      "label": "Total Frames",
      "min": 50,
      "max": 500,
      "step": 10,
      "default": 260,
      "info": "Number of frames in animation sequence"
    },
    {
      "type": "range",
      "id": "scroll_distance",
      "label": "Scroll Distance (vh)",
      "min": 500,
      "max": 3000,
      "step": 100,
      "default": 1500,
      "info": "Total scroll height for the animation"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#fffaf5"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#183754"
    }
  ],
  "blocks": [
    {
      "type": "phase",
      "name": "Phase",
      "limit": 3,
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Phase Title",
          "default": "ORIGIN"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "Phase Description",
          "default": "The journey begins with a tiny diamond seed placed in a controlled chamber."
        },
        {
          "type": "range",
          "id": "step_number_override",
          "label": "Step Number (optional)",
          "min": 1,
          "max": 10,
          "step": 1,
          "default": 1,
          "info": "Leave at 1 to use automatic numbering"
        }
      ]
    },
    {
      "type": "card",
      "name": "Image Card",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Card Image"
        },
        {
          "type": "url",
          "id": "video_url",
          "label": "Video URL (optional)",
          "info": "If provided, overrides image"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Card Title"
        },
        {
          "type": "range",
          "id": "phase_number",
          "label": "Phase Number",
          "min": 1,
          "max": 3,
          "step": 1,
          "default": 1,
          "info": "Which phase this card belongs to"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Process Hero",
      "blocks": [
        {
          "type": "phase",
          "settings": {
            "title": "ORIGIN",
            "description": "The journey begins with a tiny diamond seed placed in a controlled chamber."
          }
        },
        {
          "type": "phase",
          "settings": {
            "title": "THE REVEAL",
            "description": "Carbon atoms bond layer by layer, growing the diamond over weeks."
          }
        },
        {
          "type": "phase",
          "settings": {
            "title": "THE CUT",
            "description": "Master cutters shape the raw diamond into brilliant perfection."
          }
        }
      ]
    }
  ]
}
{% endschema %}
