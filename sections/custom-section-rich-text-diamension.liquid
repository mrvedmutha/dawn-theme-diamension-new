{{ 'section-custom-rich-text-diamension.css' | asset_url | stylesheet_tag }}

<style>
  {%- if section.settings.headline_color != blank -%}
    #shopify-section-{{ section.id }} {
      --custom-rich-text-headline-color: {{ section.settings.headline_color }};
    }
  {%- endif -%}

  {%- if section.settings.subtext_color != blank -%}
    #shopify-section-{{ section.id }} {
      --custom-rich-text-subtext-color: {{ section.settings.subtext_color }};
    }
  {%- endif -%}

  {%- if section.settings.background_color != blank -%}
    #shopify-section-{{ section.id }} {
      --custom-rich-text-bg-color: {{ section.settings.background_color }};
    }
  {%- endif -%}

  {%- if section.settings.enable_animation -%}
    #shopify-section-{{ section.id }} .custom-section-rich-text-diamension__headline,
    #shopify-section-{{ section.id }} .custom-section-rich-text-diamension__subtext {
      opacity: 0;
      transform: translateY(50px);
    }
  {%- endif -%}
</style>

<section class="custom-section-rich-text-diamension" data-section-id="{{ section.id }}" data-enable-animation="{{ section.settings.enable_animation }}">
  <div class="custom-section-rich-text-diamension__container">
    {%- if section.settings.headline != blank -%}
      <h2 class="custom-section-rich-text-diamension__headline" data-animate>
        {{ section.settings.headline }}
      </h2>
    {%- endif -%}

    {%- if section.settings.subtext != blank -%}
      <p class="custom-section-rich-text-diamension__subtext" data-animate>
        {{ section.settings.subtext }}
      </p>
    {%- endif -%}
  </div>
</section>

{%- if section.settings.enable_animation -%}
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js" defer></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const section = document.querySelector('[data-section-id="{{ section.id }}"]');
      if (!section || section.dataset.enableAnimation !== 'true') return;

      // Wait for GSAP to load
      const initAnimation = () => {
        if (typeof gsap === 'undefined' || typeof ScrollTrigger === 'undefined') {
          setTimeout(initAnimation, 100);
          return;
        }

        gsap.registerPlugin(ScrollTrigger);

        const animateElements = section.querySelectorAll('[data-animate]');

        animateElements.forEach((element, index) => {
          gsap.fromTo(element,
            {
              opacity: 0,
              y: 50
            },
            {
              opacity: 1,
              y: 0,
              duration: 0.8,
              delay: index * 0.2,
              ease: 'power3.out',
              scrollTrigger: {
                trigger: section,
                start: 'top 60%',
                end: 'bottom 20%',
                toggleActions: 'play none none reverse'
              }
            }
          );
        });
      };

      initAnimation();
    });
  </script>
{%- endif -%}

{% schema %}
{
  "name": "Custom Rich Text",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Content Settings"
    },
    {
      "type": "text",
      "id": "headline",
      "label": "Headline",
      "default": "Luxury Within Reach. Brilliance Beyond Measure"
    },
    {
      "type": "textarea",
      "id": "subtext",
      "label": "Subtext",
      "default": "Backed by HVK Diamonds' 25-year heritage, we merge mastery in craftsmanship with next-gen innovation. Every piece is crafted in 14K gold, IGI certified, and designed to be cherished for a lifetime."
    },
    {
      "type": "header",
      "content": "Color Settings"
    },
    {
      "type": "color",
      "id": "headline_color",
      "label": "Headline Color",
      "default": "#183754"
    },
    {
      "type": "color",
      "id": "subtext_color",
      "label": "Subtext Color",
      "default": "#3e6282"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#fffaf5"
    },
    {
      "type": "header",
      "content": "Animation Settings"
    },
    {
      "type": "checkbox",
      "id": "enable_animation",
      "label": "Enable Animation",
      "default": true,
      "info": "Enable GSAP ScrollTrigger text reveal animation (fade in from bottom)"
    }
  ],
  "presets": [
    {
      "name": "Custom Rich Text Diamension"
    }
  ]
}
{% endschema %}
