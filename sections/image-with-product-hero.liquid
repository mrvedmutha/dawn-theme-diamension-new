{{ 'section-image-with-product-hero.css' | asset_url | stylesheet_tag }}
<script src="{{ 'section-image-with-product-hero.js' | asset_url }}" defer="defer"></script>

{%- liquid
  assign bg_image = section.settings.background_image
  assign heading = section.settings.heading
  assign caption = section.settings.caption
  assign cta_text = section.settings.cta_text
  assign cta_link = section.settings.cta_link
  assign text_color = section.settings.text_color
  assign overlay_color = section.settings.overlay_color
  assign overlay_opacity = section.settings.overlay_opacity | times: 0.01
-%}

<section
  class="image-hero-section"
  style="
    --text-color: {{ text_color }};
    --overlay-color: {{ overlay_color }};
    --overlay-opacity: {{ overlay_opacity }};
  "
>
  {%- if bg_image != blank -%}
    <img
      src="{{ bg_image | image_url: width: 1440 }}"
      srcset="
        {{ bg_image | image_url: width: 375 }} 375w,
        {{ bg_image | image_url: width: 767 }} 767w,
        {{ bg_image | image_url: width: 1024 }} 1024w,
        {{ bg_image | image_url: width: 1440 }} 1440w,
        {{ bg_image | image_url: width: 2880 }} 2880w
      "
      sizes="100vw"
      alt="{{ bg_image.alt | escape }}"
      class="image-hero-section__background"
      loading="eager"
      fetchpriority="high"
      width="1440"
      height="1040"
    >
  {%- endif -%}

  {%- if overlay_opacity > 0 -%}
    <div class="image-hero-section__overlay"></div>
  {%- endif -%}

  <div class="image-hero-section__text-container">
    {%- if heading != blank -%}
      <h1 class="image-hero-section__heading">{{ heading }}</h1>
    {%- endif -%}

    {%- if caption != blank -%}
      <p class="image-hero-section__caption">{{ caption }}</p>
    {%- endif -%}

    {%- if cta_text != blank and cta_link != blank -%}
      <a href="{{ cta_link }}" class="image-hero-section__cta">
        {{ cta_text }}
      </a>
    {%- endif -%}
  </div>

  {%- comment -%} Product Pointers - Desktop Only {%- endcomment -%}
  {%- if section.blocks.size > 0 -%}
    <div class="image-hero-section__pointers">
      {%- for block in section.blocks limit: 6 -%}
        {%- liquid
          assign product = block.settings.product
          assign x_pos = block.settings.x_position
          assign y_pos = block.settings.y_position
          assign label = block.settings.label | default: forloop.index | prepend: '0' | slice: -2, 2
        -%}

        {%- if product != blank -%}
          {%- render 'product-pointer-card',
            product: product,
            x_pos: x_pos,
            y_pos: y_pos,
            label: label,
            index: forloop.index
          -%}
        {%- endif -%}
      {%- endfor -%}
    </div>
  {%- endif -%}
</section>

{%- comment -%} Mobile Grid - Product Cards {%- endcomment -%}
{%- if section.blocks.size > 0 -%}
  <div class="image-hero-section__mobile-grid">
    {%- for block in section.blocks limit: 6 -%}
      {%- liquid
        assign product = block.settings.product
      -%}

      {%- if product != blank -%}
        <a href="{{ product.url }}" class="image-hero-section__mobile-card" {{ block.shopify_attributes }}>
          {%- if product.featured_image != blank -%}
            <div class="image-hero-section__mobile-card-image">
              <img
                src="{{ product.featured_image | image_url: width: 308 }}"
                srcset="
                  {{ product.featured_image | image_url: width: 154 }} 1x,
                  {{ product.featured_image | image_url: width: 308 }} 2x
                "
                alt="{{ product.featured_image.alt | escape }}"
                loading="lazy"
                width="154"
                height="154"
              >
            </div>
          {%- endif -%}

          <div class="image-hero-section__mobile-card-content">
            <h3 class="image-hero-section__mobile-card-title">{{ product.title }}</h3>
            <p class="image-hero-section__mobile-card-cta">View Now</p>
          </div>
        </a>
      {%- endif -%}
    {%- endfor -%}
  </div>
{%- endif -%}

{% schema %}
{
  "name": "Image Hero with Product",
  "tag": "section",
  "class": "section-image-hero",
  "settings": [
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "Background Image",
      "info": "Recommended size: 1440Ã—1040px or larger (16:9 or 3:2 aspect ratio)"
    },
    {
      "type": "header",
      "content": "Text Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "INTO THE RED"
    },
    {
      "type": "textarea",
      "id": "caption",
      "label": "Caption",
      "default": "Jewelry that feels as good as it looks."
    },
    {
      "type": "text",
      "id": "cta_text",
      "label": "Button Text",
      "default": "Shop the Collection"
    },
    {
      "type": "url",
      "id": "cta_link",
      "label": "Button Link"
    },
    {
      "type": "header",
      "content": "Styling"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#FFFAF5"
    },
    {
      "type": "color",
      "id": "overlay_color",
      "label": "Overlay Color",
      "default": "#000000",
      "info": "Color overlay to improve text readability"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "label": "Overlay Opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "%",
      "default": 0,
      "info": "0% = no overlay, 100% = full overlay"
    }
  ],
  "blocks": [
    {
      "type": "product_pointer",
      "name": "Product Pointer",
      "limit": 6,
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Product"
        },
        {
          "type": "text",
          "id": "x_position",
          "label": "X Position (%)",
          "default": "50",
          "info": "Horizontal position from left (0-100)"
        },
        {
          "type": "text",
          "id": "y_position",
          "label": "Y Position (%)",
          "default": "50",
          "info": "Vertical position from top (0-100)"
        },
        {
          "type": "text",
          "id": "label",
          "label": "Pointer Label",
          "default": "01",
          "info": "Text displayed on the pointer (e.g., 01, 02, 03)"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Image Hero with Product"
    }
  ]
}
{% endschema %}
