{{ 'section-blog-journal.css' | asset_url | stylesheet_tag }}

{%- comment -%}
  Custom Blog Journal Section
  - Displays blog articles with category tabs
  - Responsive grid layout (4/3/2 cards)
  - Load more functionality
{%- endcomment -%}

{%- liquid
  comment
    Get blog handles from settings
    Merchant configures which blogs to show as tabs
  endcomment

  assign blog_handles_string = section.settings.blog_handles | default: ''
  assign blog_handles = blog_handles_string | split: ','

  comment
    Determine articles per page based on breakpoint
    Desktop: 4, Tablet: 3, Mobile: 2
    Using 12 as default to show 3 rows on desktop
  endcomment

  assign articles_per_page = 12
-%}

<div
  class="custom-section-blog-journal"
  data-section-id="{{ section.id }}"
  data-current-blog="{{ blog.handle }}"
  data-show-date="{{ section.settings.show_date }}"
  data-show-excerpt="{{ section.settings.show_excerpt }}"
  data-articles-count="{{ blog.articles.size }}"
  data-articles-per-page="{{ articles_per_page }}"
>
  <div class="custom-section-blog-journal__wrapper">
    <div class="custom-section-blog-journal__container">
      {%- comment -%} Section Header {%- endcomment -%}
      <div class="custom-section-blog-journal__header">
        {%- if section.settings.heading != blank -%}
          <h2 class="custom-section-blog-journal__heading">{{ section.settings.heading }}</h2>
        {%- endif -%}
      </div>

      {%- comment -%} Blog Category Tabs - Navigation Links {%- endcomment -%}
      <div class="custom-section-blog-journal__tabs-wrapper">
        {%- if blog_handles.size > 0 -%}
          <div class="custom-section-blog-journal__tabs" data-tabs-container>
            {%- comment -%} Show all configured blog tabs {%- endcomment -%}
            {%- for handle_raw in blog_handles -%}
              {%- assign handle = handle_raw | strip -%}
              {%- if handle != blank -%}
                {%- assign blog_item = blogs[handle] -%}
                {%- if blog_item -%}
                  <a
                    href="{{ blog_item.url }}"
                    class="custom-section-blog-journal__tab {% if blog.handle == blog_item.handle %}custom-section-blog-journal__tab--active{% endif %}"
                    data-blog-handle="{{ blog_item.handle }}"
                    {% if blog.handle == blog_item.handle %}
                      aria-current="page"
                    {% endif %}
                  >
                    {{ blog_item.title }}
                  </a>
                {%- endif -%}
              {%- endif -%}
            {%- endfor -%}
            <div class="custom-section-blog-journal__underline">&nbsp;</div>
          </div>
        {%- else -%}
          <div class="custom-section-blog-journal__debug">
            <p style="color: red; padding: 20px; font-family: 'Neue Haas Grotesk Display Pro', sans-serif;">
              <strong>Please configure blog handles in section settings.</strong>
              <br>
              <br>
              Add blog handles (comma separated) like: <br>
              news,styling-guide,jewellery-care
            </p>
          </div>
        {%- endif -%}
      </div>

      {%- comment -%} Blog Articles Grid {%- endcomment -%}
      <div class="custom-section-blog-journal__grid" data-articles-grid>
        {%- comment -%} Display articles from current blog {%- endcomment -%}

        {%- if blog.articles.size > 0 -%}
          {%- for article in blog.articles limit: articles_per_page -%}
            <div class="custom-section-blog-journal__card" data-article-card>
              <div class="custom-section-blog-journal__image-holder">
                {%- if article.image -%}
                  <a href="{{ article.url }}" class="custom-section-blog-journal__image-link">
                    <img
                      src="{{ article.image | image_url: width: 688 }}"
                      srcset="
                        {{ article.image | image_url: width: 344 }} 344w,
                        {{ article.image | image_url: width: 688 }} 688w
                      "
                      sizes="(max-width: 767px) 50vw, (max-width: 1024px) 33vw, 25vw"
                      alt="{{ article.image.alt | escape }}"
                      class="custom-section-blog-journal__image"
                      loading="lazy"
                    >
                  </a>
                {%- else -%}
                  <div class="custom-section-blog-journal__image-placeholder"></div>
                {%- endif -%}
              </div>

              <div class="custom-section-blog-journal__content">
                {%- if section.settings.show_date -%}
                  <p class="custom-section-blog-journal__date">
                    {{ article.published_at | date: '%d/%m/%y' }}
                  </p>
                {%- endif -%}

                {%- if article.title != blank -%}
                  <h3 class="custom-section-blog-journal__title">
                    <a href="{{ article.url }}">{{ article.title }}</a>
                  </h3>
                {%- endif -%}

                {%- if section.settings.show_excerpt and article.excerpt != blank -%}
                  <div class="custom-section-blog-journal__excerpt">
                    {{ article.excerpt | strip_html | truncate: 150 }}
                  </div>
                {%- endif -%}
              </div>
            </div>
          {%- endfor -%}
        {%- else -%}
          <div class="custom-section-blog-journal__empty">
            <p>No articles found in this blog.</p>
          </div>
        {%- endif -%}
      </div>

      {%- comment -%} Load More Button {%- endcomment -%}
      <div class="custom-section-blog-journal__load-more-wrapper">
        <button class="custom-section-blog-journal__load-more" data-load-more-btn style="display: none;">
          {{ section.settings.load_more_text | default: 'LOAD MORE' }}
        </button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="{{ 'section-blog-journal.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Blog Journal",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Section Heading",
      "default": "DIAMENSIONS JOURNAL"
    },
    {
      "type": "textarea",
      "id": "blog_handles",
      "label": "Blog Handles (comma separated)",
      "default": "news,styling-guide,jewellery-care,celebrity-looks",
      "info": "Enter blog handles separated by commas. These will appear as tabs. Example: news,styling-guide,jewellery-care"
    },
    {
      "type": "checkbox",
      "id": "show_date",
      "label": "Show Article Date",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_excerpt",
      "label": "Show Article Excerpt",
      "default": true
    },
    {
      "type": "text",
      "id": "load_more_text",
      "label": "Load More Button Text",
      "default": "LOAD MORE"
    }
  ],
  "presets": [
    {
      "name": "Blog Journal"
    }
  ],
  "templates": ["blog"]
}
{% endschema %}
