{{ 'section-brillance-3d.css' | asset_url | stylesheet_tag }}

{%- comment -%} Desktop Version {%- endcomment -%}
<div class="brillance-3d__wrapper">
  <div class="brillance-3d" data-section-id="{{ section.id }}">
    {%- comment -%} Pinned Content Container {%- endcomment -%}
    <div class="brillance-3d__pinned" data-pinned-container>
      {%- comment -%} Canvas for Image Sequences {%- endcomment -%}
      <canvas
        class="brillance-3d__canvas brillance-3d__canvas--background"
        data-canvas-bg
        width="1920"
        height="1080"
        aria-label="Brilliance 3D background animation"
      ></canvas>

      <canvas
        class="brillance-3d__canvas brillance-3d__canvas--foreground"
        data-canvas-fg
        width="1920"
        height="1080"
        aria-label="Brilliance 3D foreground animation"
      ></canvas>

      {%- comment -%} Content Overlay {%- endcomment -%}
      <div class="brillance-3d__content">
        {%- if section.settings.heading != blank -%}
          <h2 class="brillance-3d__heading">{{ section.settings.heading }}</h2>
        {%- endif -%}

        {%- if section.settings.paragraph != blank -%}
          <div class="brillance-3d__paragraph-wrapper" data-paragraph-wrapper>
            <p class="brillance-3d__paragraph" data-paragraph>
              {{ section.settings.paragraph }}
            </p>
          </div>
        {%- endif -%}

        {%- if section.settings.cta_text != blank -%}
          <div class="brillance-3d__cta-wrapper">
            <a
              href="{{ section.settings.cta_url }}"
              class="brillance-3d__cta"
              data-cta
            >
              {{ section.settings.cta_text }}
            </a>
          </div>
        {%- endif -%}
      </div>
    </div>

    {%- comment -%} Spacer for Scroll Distance {%- endcomment -%}
    <div class="brillance-3d__spacer" data-spacer>&nbsp;</div>

    {%- comment -%} Preload ALL images during page load for seamless animation {%- endcomment -%}
    <div class="brillance-3d__preload" hidden aria-hidden="true">
      {%- assign max_frame = section.settings.frame_count | minus: 1 -%}
      {%- comment -%} Background images {%- endcomment -%}
      {%- for i in (0..max_frame) -%}
        {%- assign frame_num = i | plus: 1 | prepend: '000' | slice: -4, 4 -%}
        <link rel="preload" as="image" href="{{ 'custom-section-brillance-3d/background-sequence/2FEB26-BGCubesWebP-f' | append: frame_num | append: 'Output.webp' | asset_url }}">
      {%- endfor -%}
      {%- comment -%} Foreground images {%- endcomment -%}
      {%- for i in (0..max_frame) -%}
        {%- assign frame_num = i | plus: 1 | prepend: '000' | slice: -4, 4 -%}
        <link rel="preload" as="image" href="{{ 'custom-section-brillance-3d/front-sequence/2FEB26-TweezersCubesWebP-f' | append: frame_num | append: 'Output.webp' | asset_url }}">
      {%- endfor -%}
    </div>

    {%- comment -%} Image Data for JavaScript {%- endcomment -%}
    <script>
      window.brillance3dData = window.brillance3dData || {};
      window.brillance3dData['{{ section.id }}'] = {
        backgroundUrls: [
          {%- for i in (0..max_frame) -%}
            {%- assign frame_num = i | plus: 1 | prepend: '000' | slice: -4, 4 -%}
            "{{ 'custom-section-brillance-3d/background-sequence/2FEB26-BGCubesWebP-f' | append: frame_num | append: 'Output.webp' | asset_url }}"{% unless forloop.last %},{% endunless %}
          {%- endfor -%}
        ],
        foregroundUrls: [
          {%- for i in (0..max_frame) -%}
            {%- assign frame_num = i | plus: 1 | prepend: '000' | slice: -4, 4 -%}
            "{{ 'custom-section-brillance-3d/front-sequence/2FEB26-TweezersCubesWebP-f' | append: frame_num | append: 'Output.webp' | asset_url }}"{% unless forloop.last %},{% endunless %}
          {%- endfor -%}
        ]
      };
    </script>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js" defer></script>
<script src="{{ 'section-brillance-3d.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Brilliance 3D Animation",
  "class": "section-brillance-3d",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Brilliance Made by Us."
    },
    {
      "type": "textarea",
      "id": "paragraph",
      "label": "Paragraph",
      "default": "At Diamensions, we manufacture every lab-grown diamond. This control over the journey — from creation to craftsmanship — ensures purity, sustainability, and perfection you can trust."
    },
    {
      "type": "text",
      "id": "cta_text",
      "label": "CTA Text",
      "default": "Explore the Journey"
    },
    {
      "type": "url",
      "id": "cta_url",
      "label": "CTA URL",
      "default": "/collections/all"
    },
    {
      "type": "header",
      "content": "Animation Settings"
    },
    {
      "type": "range",
      "id": "frame_count",
      "label": "Total Frames",
      "min": 50,
      "max": 500,
      "step": 10,
      "default": 260,
      "info": "Number of frames in your animation sequence"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#fffcf9"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#183754"
    }
  ],
  "presets": [
    {
      "name": "Brilliance 3D Animation"
    }
  ]
}
{% endschema %}
