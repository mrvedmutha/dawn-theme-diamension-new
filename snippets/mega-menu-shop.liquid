{% comment %}
  Mega Menu for SHOP navigation item

  Accepts:
  - blocks: array of blocks from the parent section

  Usage:
  {% render 'mega-menu-shop', blocks: section.blocks %}
{% endcomment %}

{{ 'mega-menu-shop.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign menu_columns = blocks | where: 'type', 'mega_menu_column'
  assign featured_cards = blocks | where: 'type', 'mega_menu_featured_card'
  assign max_featured_cards = 2
-%}

<div class="mega-menu-shop" data-mega-menu="shop">
  <div class="mega-menu-shop__wrapper">
    <div class="mega-menu-shop__container">

      {%- comment -%} Menu Columns Section {%- endcomment -%}
      {%- if menu_columns.size > 0 -%}
        <div class="mega-menu-shop__columns">
          {%- for block in menu_columns limit: 6 -%}
            <div class="mega-menu-shop__column" {{ block.shopify_attributes }}>
              {%- if block.settings.heading != blank -%}
                <h3 class="mega-menu-shop__column-heading">
                  {{ block.settings.heading }}
                </h3>
              {%- endif -%}

              {%- if block.settings.menu != blank -%}
                <ul class="mega-menu-shop__links">
                  {%- for link in block.settings.menu.links -%}
                    <li class="mega-menu-shop__link-item">
                      <a href="{{ link.url }}" class="mega-menu-shop__link">
                        {{ link.title }}
                      </a>
                    </li>
                  {%- endfor -%}
                </ul>
              {%- endif -%}
            </div>
          {%- endfor -%}
        </div>
      {%- endif -%}

      {%- comment -%} Featured Cards Section {%- endcomment -%}
      {%- if featured_cards.size > 0 -%}
        <div class="mega-menu-shop__featured">
          {%- for block in featured_cards limit: max_featured_cards -%}
            <div class="mega-menu-shop__card" {{ block.shopify_attributes }}>
              {%- if block.settings.image != blank -%}
                <div class="mega-menu-shop__card-image">
                  {{
                    block.settings.image
                    | image_url: width: 306
                    | image_tag:
                      loading: 'lazy',
                      widths: '153, 306',
                      sizes: '153px'
                  }}
                </div>
              {%- else -%}
                <div class="mega-menu-shop__card-image mega-menu-shop__card-image--placeholder">
                  {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
                </div>
              {%- endif -%}

              {%- if block.settings.heading != blank -%}
                <h4 class="mega-menu-shop__card-heading">
                  {%- if block.settings.link != blank -%}
                    <a href="{{ block.settings.link }}" class="mega-menu-shop__card-link">
                      {{ block.settings.heading }}
                    </a>
                  {%- else -%}
                    {{ block.settings.heading }}
                  {%- endif -%}
                </h4>
              {%- endif -%}
            </div>
          {%- endfor -%}
        </div>
      {%- endif -%}

    </div>
  </div>
</div>
